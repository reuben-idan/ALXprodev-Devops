#!/bin/bash

# PokÃ©mon Data Summary Script
# Reads JSON files and generates a CSV report with averages

DATA_DIR="pokemon_data"
CSV_FILE="pokemon_report.csv"

# Check if pokemon_data directory exists
if [ ! -d "$DATA_DIR" ]; then
    echo "Error: $DATA_DIR directory not found!"
    echo "Please run the batch processing script first."
    exit 1
fi

# Create CSV header
echo "Name,Height (m),Weight (kg)" > "$CSV_FILE"

# Process each JSON file in the pokemon_data directory
for json_file in "$DATA_DIR"/*.json; do
    if [ -f "$json_file" ]; then
        # Extract name, height, and weight using jq
        name=$(jq -r '.name' "$json_file" | sed 's/.*/\u&/')
        height=$(jq -r '.height' "$json_file")
        weight=$(jq -r '.weight' "$json_file")
        
        # Convert height (decimeters to meters) and weight (hectograms to kg)
        height_m=$(echo "$height" | awk '{printf "%.1f", $1/10}')
        weight_kg=$(echo "$weight" | awk '{printf "%.1f", $1/10}')
        
        # Add to CSV
        echo "$name,$height_m,$weight_kg" >> "$CSV_FILE"
    fi
done

# Calculate averages using awk
echo "CSV Report generated at: $CSV_FILE"
echo ""

# Display the CSV content
cat "$CSV_FILE"

echo ""

# Calculate and display averages
awk -F',' 'NR>1 {height_sum+=$2; weight_sum+=$3; count++} 
END {
    if (count > 0) {
        avg_height = height_sum / count
        avg_weight = weight_sum / count
        printf "Average Height: %.2f m\n", avg_height
        printf "Average Weight: %.2f kg\n", avg_weight
    }
}' "$CSV_FILE" 